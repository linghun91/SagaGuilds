# SagaGuild 兼容性说明

## Adventure API 兼容性

SagaGuild 插件使用了 Paper 1.20.1 的 Adventure API 来处理文本组件和聊天功能。为了确保插件在不同类型的服务端上都能正常工作，我们进行了以下兼容性处理：

### 1. 内置 Adventure API

从版本 1.0.1 开始，SagaGuild 插件将 Adventure API 库打包进插件 JAR 文件中，并进行了重定位处理。这意味着即使服务端没有提供 Adventure API，插件也能正常工作。

### 2. API 兼容层

我们添加了一个兼容层，用于处理不同服务端 API 的差异：

- `TeamUtil` 类：处理团队前缀设置的兼容性问题，自动检测服务端支持的 API 并使用适当的方法
- `ChatListener` 类：使用通用的 `AsyncPlayerChatEvent` 而非 Paper 特有的 `AsyncChatEvent`，确保与各种服务端兼容
- `InventoryUtil` 类：处理物品栏创建的兼容性问题，自动检测服务端支持的 API 并使用适当的方法
- `ItemUtil` 类：处理物品元数据的兼容性问题，包括：
  - 设置物品名称和描述（`setDisplayName`、`setLore`）
  - 获取物品名称和描述（`getDisplayName`、`getLore`）

### 3. 支持的服务端

SagaGuild 插件现在支持以下服务端：

- **Paper 1.20.1**：完全支持，使用原生 Adventure API
- **Spigot 1.20.1**：完全支持，使用内置 Adventure API
- **Bukkit 1.20.1**：完全支持，使用内置 Adventure API
- **Forge 服务端**：通过兼容层支持，使用传统 API
- **Mohist 服务端**：通过兼容层支持，使用传统聊天事件

### 4. 已知问题

- 在某些 Forge 服务端上，聊天格式可能略有不同
- 在极少数情况下，可能需要重启服务器才能完全应用兼容性修复

## 如何报告兼容性问题

如果您在特定服务端上遇到兼容性问题，请提供以下信息：

1. 服务端类型和版本（例如：Paper 1.20.1, Forge 1.20.1 等）
2. 错误日志（如果有）
3. 问题的详细描述
4. 复现步骤

请将上述信息发送至我们的支持邮箱或在 GitHub 仓库中创建 Issue。

## 技术细节

### Adventure API 重定位

为了避免与服务端可能提供的 Adventure API 冲突，我们将 Adventure API 重定位到以下包：

- `net.kyori.adventure` → `cn.i7mc.sagaguild.libs.adventure`
- `net.kyori.examination` → `cn.i7mc.sagaguild.libs.examination`

### 兼容性检测

插件会在启动时自动检测服务端支持的 API，并选择适当的实现方式：

```java
try {
    // 尝试获取Team.prefix(Component)方法
    Team.class.getMethod("prefix", Component.class);
    useAdventure = true;
} catch (NoSuchMethodException e) {
    useAdventure = false;
    // 尝试获取传统的Team.setPrefix(String)方法
    legacyPrefixMethod = Team.class.getMethod("setPrefix", String.class);
}
```

这种方法确保插件可以在不同的服务端环境中正常工作，无需用户进行额外配置。
