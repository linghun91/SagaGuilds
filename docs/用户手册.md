# SagaGuild 用户手册

## 目录

1. [插件介绍](#插件介绍)
2. [安装与配置](#安装与配置)
3. [基础命令](#基础命令)
4. [公会创建与管理](#公会创建与管理)
5. [成员管理](#成员管理)
6. [公会邀请系统](#公会邀请系统)
7. [公会加入申请系统](#公会加入申请系统)
8. [公会领地系统](#公会领地系统)
9. [公会银行系统](#公会银行系统)
10. [公会等级与升级](#公会等级与升级)
11. [公会任务系统](#公会任务系统)
12. [公会活动系统](#公会活动系统)
13. [公会战系统](#公会战系统)
14. [公会联盟系统](#公会联盟系统)
15. [公会关系系统](#公会关系系统)
16. [公会聊天系统](#公会聊天系统)
17. [PlaceholderAPI占位符](#PlaceholderAPI占位符)
18. [GUI界面使用指南](#GUI界面使用指南)
19. [常见问题解答](#常见问题解答)

## 插件介绍

SagaGuild 提供了丰富的公会管理功能，包括公会创建、成员管理、领地系统、公会等级、公会战等多种功能，让玩家能够组建自己的公会，共同探索、建设和征战。

### 主要特性

- **完整的公会系统**：创建、解散、管理公会
- **灵活的成员管理**：邀请、申请、踢出、提升、降级成员
- **双向加入机制**：支持邀请系统和申请系统
- **领地系统**：声明和保护公会领地
- **银行系统**：公会共享资金管理
- **等级系统**：通过活动提升公会等级
- **任务系统**：完成任务获得奖励
- **活动系统**：组织公会活动
- **公会战系统**：与其他公会进行对抗
- **联盟系统**：与其他公会结成联盟
- **公会关系管理**：统一管理联盟、战争等关系
- **聊天系统**：公会内部专属聊天频道
- **PlaceholderAPI集成**：支持在聊天、记分板等显示公会信息
- **直观的GUI界面**：便捷管理公会的各项功能

## 安装与配置

### 系统要求

- Bukkit 1.20.1 服务器（推荐）或兼容服务器
  - 支持：Bukkit、Spigot、Bukkit、Forge、Mohist等服务端
- Java 17 或更高版本
- 可选依赖：PlaceholderAPI（用于占位符功能）

### 安装步骤

1. 下载 SagaGuild.jar 文件
2. 将文件放入服务器的 plugins 文件夹中
3. 重启服务器或使用插件管理器加载插件
4. 插件将自动生成配置文件

### 配置文件

插件首次加载时会生成以下配置文件：

- `config.yml`：主配置文件
- `messages.yml`：消息配置文件
- `database.db`：SQLite 数据库文件

#### 主要配置选项

```yaml
# 公会设置
guild:
  # 公会名称长度限制
  min-name-length: 3
  max-name-length: 16
  
  # 公会标签长度限制
  min-tag-length: 2
  max-tag-length: 5
  
  # 最大成员数量
  max-members: 50
  
  # 创建公会所需费用
  creation-cost: 1000
  
# 领地设置
land:
  # 每级可声明的最大区块数
  chunks-per-level: 5
  
  # 声明区块的费用
  claim-cost: 100
  
# 经验设置
experience:
  # 各种活动获得的经验值
  block-break: 1
  block-place: 1
  mob-kill: 5
  player-kill: 20
```

## 基础命令

SagaGuild 插件的所有命令都以 `/guild` 或 `/g` 开头。

### 帮助命令

- `/guild help` - 显示帮助信息
- `/guild help <页码>` - 显示指定页码的帮助信息

### 信息查询

- `/guild info` - 查看自己所在公会的信息
- `/guild info <公会名>` - 查看指定公会的信息
- `/guild list` - 打开公会列表GUI

## 公会创建与管理

### 创建公会

- `/guild create <名称> <标签> <描述>` - 创建一个新公会
  - 例如：`/guild create 勇者联盟 勇者 最强的公会联盟`

### 公会管理

- `/guild manage` - 打开公会管理GUI
- `/guild settings` - 打开公会设置GUI（仅会长可用）
- `/guild disband` - 解散公会（仅会长可用）

## 成员管理

### 成员操作

- `/guild invite <玩家>` - 邀请玩家加入公会
- `/guild join <公会名>` - 加入一个公开的公会
- `/guild leave` - 离开当前公会
- `/guild kick <玩家>` - 踢出公会成员（需要权限）

### 职位管理

- `/guild promote <玩家>` - 提升成员职位（需要权限）
- `/guild demote <玩家>` - 降低成员职位（需要权限）
- `/guild transfer <玩家>` - 转让会长职位（仅会长可用）

### 成员管理GUI

- `/guild members` - 打开成员管理GUI

## 公会邀请系统

SagaGuild 提供了主动的邀请系统，允许公会管理层邀请玩家加入公会。

### 邀请功能特点

- **主动招募**：公会会长和管理员可以向任何在线玩家发送邀请
- **便捷操作**：被邀请玩家收到包含点击按钮的互动消息
- **快速响应**：点击消息中的 [接受] 或 [拒绝] 按钮即可处理邀请
- **时效管理**：邀请具有5分钟时效，超时自动失效
- **防重复机制**：玩家同时只能收到一个邀请，避免干扰

### 邀请相关命令

- `/guild invite <玩家名>` - 邀请指定玩家加入公会（需要管理员权限）
- `/guild inviteaccept` - 接受收到的邀请
- `/guild invitereject` - 拒绝收到的邀请

### 使用说明

1. **发送邀请**：
   - 公会会长或管理员使用 `/guild invite <玩家名>` 命令
   - 被邀请玩家会收到包含互动按钮的消息
   - 如果玩家已在其他公会或已有待处理邀请，会收到相应提示

2. **处理邀请**：
   - 被邀请玩家点击消息中的 [接受] 按钮或使用 `/guild inviteaccept` 命令接受邀请
   - 点击 [拒绝] 按钮或使用 `/guild invitereject` 命令拒绝邀请
   - 邀请会在5分钟后自动过期

3. **权限要求**：
   - 只有公会会长和管理员可以发送邀请
   - 无法向已有公会的玩家发送邀请
   - 无法重复向同一玩家发送邀请

## 公会加入申请系统

SagaGuild 提供了灵活的申请加入系统，玩家可以主动申请加入心仪的公会。

### 申请功能特点

- **主动申请**：玩家可以浏览公会列表并申请加入
- **多重申请**：支持同时向多个公会申请，提高加入成功率
- **智能处理**：一旦被某个公会接受，其他申请自动取消
- **管理审核**：公会管理员可以查看和处理所有申请
- **灵活决策**：管理员可以接受或拒绝申请

### 申请相关操作

- **玩家操作**：
  - `/guild list` - 打开公会列表GUI，浏览并申请加入公会
  - 在公会列表中点击公会图标查看详情并申请
  - 可同时向多个公会发送申请

- **管理员操作**：
  - `/guild manage` - 打开公会管理GUI
  - 在管理界面中点击"加入申请管理"查看所有申请
  - 可以接受或拒绝申请

### 申请流程说明

1. **发送申请**：
   - 玩家通过公会列表GUI浏览所有公会
   - 点击感兴趣的公会图标查看详细信息
   - 点击 [申请加入] 按钮发送申请

2. **申请管理**：
   - 公会管理员收到申请通知
   - 在公会管理GUI中查看申请列表
   - 查看申请者信息并做出决定

3. **申请处理**：
   - 管理员可以接受或拒绝申请
   - 接受申请后，玩家自动加入公会，其他申请被取消
   - 拒绝申请后，玩家收到通知，可以申请其他公会

## GUI界面使用指南

SagaGuild 提供了直观的图形界面，方便玩家管理公会的各项功能。

### 公会列表GUI

通过 `/guild list` 命令打开公会列表GUI，可以浏览服务器中的所有公会。

- **功能**：
  - 显示所有公会的基本信息
  - 点击公会图标查看详细信息
  - 支持分页浏览
  - 提供搜索功能

### 公会管理GUI

通过 `/guild manage` 命令打开公会管理GUI，可以管理公会的各项功能。

- **功能**：
  - 公会基本信息管理
  - 成员管理
  - 银行管理
  - 领地管理
  - 活动管理
  - 任务管理
  - 联盟管理
  - 公会战管理

### 公会成员管理GUI

通过 `/guild members` 命令或在公会管理GUI中点击成员管理按钮打开。

- **功能**：
  - 显示所有公会成员
  - 查看成员详细信息
  - 提升/降级成员
  - 踢出成员
  - 转让会长职位

### 公会设置GUI

通过 `/guild settings` 命令或在公会管理GUI中点击设置按钮打开（仅会长可用）。

- **功能**：
  - 公会公开性设置
  - 公会描述和公告设置
  - 公会标签颜色设置
  - 领地相关设置
  - 聊天设置

## 公会关系系统

SagaGuild 提供了完整的公会关系管理系统，支持联盟和战争等多种关系类型。

### 关系类型

- **联盟关系**：友好的合作关系，联盟公会成员之间无法互相伤害
- **战争关系**：敌对的对抗关系，战争期间击杀敌对公会成员会获得积分
- **中立关系**：普通的中立关系，没有特殊限制

### 关系管理命令

- `/guild relation` - 打开公会关系管理GUI
- `/guild relation list` - 显示当前公会的所有关系
- `/guild relation ally <公会名>` - 申请与指定公会结盟
- `/guild relation war <公会名>` - 向指定公会宣战
- `/guild relation break <公会名>` - 解除与指定公会的联盟关系
- `/guild relation ceasefire <公会名>` - 向敌对公会请求停战

### 关系管理GUI

通过 `/guild relation` 命令打开关系管理界面：

- **关系设置**：管理与其他公会的关系
  - 结盟申请：向其他公会发送联盟请求
  - 宣战操作：向其他公会宣战
  - 解除联盟：终止现有的联盟关系
  - 停战请求：向敌对公会请求停战

- **关系管理**：处理收到的关系请求
  - 查看联盟请求并选择接受或拒绝
  - 处理停战请求
  - 管理当前的关系状态

### 关系规则

1. **联盟规则**：
   - 联盟公会成员之间无法互相伤害
   - 联盟关系需要双方同意
   - 联盟公会无法相互宣战
   - 任何一方都可以解除联盟关系

2. **战争规则**：
   - 战争状态下击杀敌对公会成员会在动作条显示
   - 击杀会被记录到战争积分系统
   - 任何一方都可以请求停战
   - 停战需要对方同意

3. **关系优先级**：
   - 联盟关系优先于战争关系
   - 必须先解除联盟才能宣战
   - 停战后恢复中立关系

## PlaceholderAPI占位符

SagaGuild 支持 PlaceholderAPI，可在聊天插件、记分板插件、TAB插件等支持占位符的插件中显示公会相关信息。

### 安装要求

- 需要安装 PlaceholderAPI 插件
- SagaGuild 会自动检测并注册占位符扩展

### 玩家公会信息占位符

以下占位符显示玩家当前所在公会的信息，支持离线玩家查询：

- `%sg_currentguild_name%` - 玩家所在公会名称
- `%sg_currentguild_tag%` - 玩家所在公会标签
- `%sg_currentguild_description%` - 玩家所在公会描述
- `%sg_currentguild_level%` - 玩家所在公会等级
- `%sg_currentguild_role%` - 玩家在公会的职位（会长/副会长/长老/成员）
- `%sg_currentguild_owner%` - 玩家所在公会会长名称
- `%sg_currentguild_currentmembers%` - 玩家所在公会当前人数
- `%sg_currentguild_maxmembers%` - 玩家所在公会最大人数（根据等级计算）
- `%sg_currentguild_money%` - 玩家所在公会银行余额
- `%sg_currentguild_warstats%` - 玩家所在公会战争状态（和平/战争中）
- `%sg_currentguild_allystats%` - 玩家所在公会联盟关系（无联盟/已结盟）

### 公会排行榜占位符

以下占位符显示公会排行榜信息，支持动态排名（1-10名）：

#### 银行资金排行榜
- `%sg_top1_money_gname%` - 资金排行榜第1名公会名称
- `%sg_top1_money_value%` - 资金排行榜第1名公会的资金值
- 支持 `top1` 到 `top10` 的任意排名

#### 成员数量排行榜
- `%sg_top3_members_gname%` - 人数排行榜第3名公会名称
- `%sg_top3_members_value%` - 人数排行榜第3名公会的成员数
- 支持 `top1` 到 `top10` 的任意排名

#### 公会等级排行榜
- `%sg_top5_level_gname%` - 等级排行榜第5名公会名称
- `%sg_top5_level_value%` - 等级排行榜第5名公会的等级值
- 支持 `top1` 到 `top10` 的任意排名

### 占位符使用示例

在聊天格式中使用：
```
格式: &7[%sg_currentguild_tag%&7] &f%player_name%: %message%
效果: [勇者] 张三: 大家好！
```

在记分板中使用：
```
公会: %sg_currentguild_name%
等级: %sg_currentguild_level%
成员: %sg_currentguild_currentmembers%/%sg_currentguild_maxmembers%
资金: %sg_currentguild_money%
```

### 占位符特性

- **离线支持**：所有玩家公会占位符都支持离线玩家查询
- **错误处理**：当玩家未加入公会或查询失败时，占位符返回空字符串
- **性能优化**：排行榜数据使用5分钟缓存，避免频繁数据库查询
- **实时更新**：公会信息变更会实时反映在占位符中

## 常见问题解答

### Q: 如何创建公会？
A: 使用命令 `/guild create <名称> <标签> <描述>` 创建公会。例如：`/guild create 勇者联盟 勇者 最强的公会联盟`。

### Q: 如何邀请玩家加入公会？
A: 使用命令 `/guild invite <玩家名>` 邀请玩家加入公会。

### Q: 如何提升公会等级？
A: 公会成员通过各种活动（如挖矿、建造、击杀怪物等）获得经验，累积到一定程度后公会自动升级。

### Q: 如何声明公会领地？
A: 站在想要声明的区块上，使用命令 `/guild claim` 声明该区块为公会领地。

### Q: 如何管理公会成员权限？
A: 打开公会成员管理GUI（`/guild members`），点击成员头像可以进行权限管理。

### Q: 公会解散后领地会怎样？
A: 公会解散后，所有领地将被释放，其他公会可以重新声明这些区块。

### Q: 如何转让公会会长？
A: 使用命令 `/guild transfer <玩家名>` 或在成员管理GUI中操作。

### Q: 如何发起公会战？
A: 使用命令 `/guild relation war <公会名>` 向其他公会宣战，或通过公会关系GUI操作。

### Q: 如何邀请玩家加入公会？
A: 使用命令 `/guild invite <玩家名>` 邀请玩家，被邀请玩家会收到包含点击按钮的消息。

### Q: 如何申请加入公会？
A: 使用命令 `/guild list` 打开公会列表GUI，点击公会图标查看详情并申请加入。

### Q: 如何管理公会关系？
A: 使用命令 `/guild relation` 打开关系管理GUI，可以管理联盟、战争等关系。

### Q: 如何使用PlaceholderAPI占位符？
A: 安装PlaceholderAPI插件后，可以在聊天格式、记分板等地方使用 `%sg_xxx%` 格式的占位符显示公会信息。

### Q: 公会等级有什么限制？
A: 不同等级的公会有不同的成员上限，1级公会最多10人，10级公会最多100人。领地声明数量也受等级限制。

## 权限节点

SagaGuild 使用以下权限节点控制玩家的操作权限：

### 基础权限
- `guild.create` - 创建公会的权限
- `guild.join` - 加入公会的权限
- `guild.info` - 查看公会信息的权限
- `guild.list` - 查看公会列表的权限
- `guild.help` - 查看帮助信息的权限

### 成员管理权限
- `guild.invite` - 邀请玩家加入公会的权限
- `guild.kick` - 踢出公会成员的权限
- `guild.promote` - 提升成员职位的权限
- `guild.demote` - 降低成员职位的权限
- `guild.transfer` - 转让公会会长的权限

### 公会管理权限
- `guild.disband` - 解散公会的权限
- `guild.settings` - 修改公会设置的权限
- `guild.manage` - 访问公会管理GUI的权限

### 功能权限
- `guild.claim` - 声明领地的权限
- `guild.unclaim` - 取消领地声明的权限
- `guild.bank` - 使用公会银行的权限
- `guild.chat` - 使用公会聊天的权限
- `guild.activity` - 管理公会活动的权限
- `guild.task` - 查看和完成公会任务的权限

### 高级功能权限
- `guild.war` - 发起公会战的权限
- `guild.ally` - 结成联盟的权限
- `guild.relation` - 管理公会关系的权限

### 管理员权限
- `guild.admin` - 管理员权限，可以管理所有公会
- `guild.admin.reload` - 重新加载插件配置的权限
- `guild.admin.create` - 为其他玩家创建公会的权限
- `guild.admin.disband` - 强制解散公会的权限
- `guild.admin.setowner` - 强制转让公会会长的权限

### 权限组建议

**普通玩家权限组**：
```
guild.create
guild.join
guild.info
guild.list
guild.help
guild.invite
guild.bank
guild.chat
guild.task
```

**公会管理员权限组**：
```
# 包含普通玩家的所有权限，另外添加：
guild.kick
guild.promote
guild.demote
guild.settings
guild.manage
guild.claim
guild.unclaim
guild.activity
guild.war
guild.ally
guild.relation
```

**服务器管理员权限组**：
```
guild.admin
guild.admin.*
```
